<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>首页</title>
		<!--重置浏览器样式-->
		<link rel="stylesheet" type="text/css" href="css/common.css" />
		<link rel="stylesheet" type="text/css" href="css/default.css" />
		<link rel="stylesheet" type="text/css" href="css/echo.css" />
		<script src="js/hotcss.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/jquery-3.1.1.min.js" type="text/javascript" charset="utf-8"></script>
		<!--<script src="js/TouchSlide.1.1.js" type="text/javascript" charset="utf-8"></script>-->
		<script src="js/fastclick.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			$(function() {
				FastClick.attach(document.body);
			});
		</script>
	</head>

	<body style="background: #f5f5f5;">
		<div class="container" id="container">
			<div id="banner" class="banner">
				<a href=""><img src="img/banner.png">
					<div class="zkq">
						<img src="img/img.jpg"/>
						<img src="img/img1.jpg"/>
						<img src="img/img.jpg"/>
					</div>
				</a>
				<!--<div class="hd">
					<ul></ul>
				</div>
				<div class="bd">
					<ul>
						<li>
							<a href=""><img src="img/banner.png"></a>
						</li>
						<li>
							<a href=""><img src="img/ban.jpg" /></a>
						</li>
					</ul>
				</div>-->
			</div>
			<!--<script type="text/javascript">
				TouchSlide({
					slideCell: "#banner",
					titCell: ".hd ul",
					mainCell: ".bd ul",
					autoPage: true,
					effect: "leftLoop",
					autoPlay: true
				});
			</script>-->
			<section class="indexContent clearfix">
				<aside class="menu">
					<ul>
						<li class="on">最多1个字</li>
						<li>最多2个字</li>
						<li>最多3个字</li>
						<li>最多4个字</li>
						<li>最多5个字</li>
						<li>最多6个字</li>
						<li>最多7个字</li>
						<li>最多8个字</li>
						<li>最多9个字</li>
						<li>最多10个字</li>
						<li>最多11个字</li>
						<li>最多12个字</li>
						<li>最多13个字</li>
						<li>最多14个字</li>
						<li>最多15个字</li>
					</ul>
				</aside>

				<section class="content">
					<div class="item">
						<p>最多1个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨10">秘制排骨10</i>卖光了</h2>
									<span class="money">￥<strong>10.2</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">0</span><span class="add"></span>
									</div>
								</div>
							</li>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨11">秘制排骨11</i>卖光了</h2>
									<span class="money">￥<strong>10.2</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">0</span><span class="add"></span>
									</div>
								</div>
							</li>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨12">秘制排骨12</i>卖光了</h2>
									<span class="money">￥<strong>10.2</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">0</span><span class="add"></span>
									</div>
								</div>
							</li>
						</ul>
					</div>

					<div class="item">
						<p>最多2个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨20">秘制排骨20</i>卖光了</h2>
									<span class="money">￥<strong>10.6</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">9</span><span class="add"></span>
									</div>
								</div>
							</li>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨21">秘制排骨21</i>卖光了</h2>
									<span class="money">￥<strong>10.6</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">9</span><span class="add"></span>
									</div>
								</div>
							</li>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨22">秘制排骨22</i>卖光了</h2>
									<span class="money">￥<strong>10.6</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">9</span><span class="add"></span>
									</div>
								</div>
							</li>
						</ul>
					</div>
					<div class="item">
						<p>最多3个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨3">秘制排骨3</i>卖光了</h2>
									<span class="money">￥<strong>10</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">10</span><span class="add"></span>
									</div>
								</div>
							</li>
						</ul>
					</div>
					<div class="item">
						<p>最多4个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨4">秘制排骨4</i>卖光了</h2>
									<span class="money">￥<strong>10</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">11</span><span class="add"></span>
									</div>
								</div>
							</li>
							
						</ul>
					</div>
					<div class="item">
						<p>最多5个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨5">秘制排骨5</i>卖光了</h2>
									<span class="money">￥<strong>10</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">12</span><span class="add"></span>
									</div>
								</div>
							</li>
							
						</ul>
					</div>
					<div class="item">
						<p>最多6个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨6">秘制排骨6</i>卖光了</h2>
									<span class="money">￥<strong>10</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">13</span><span class="add"></span>
									</div>
								</div>
							</li>
							
						</ul>
					</div>
					<div class="item">
						<p>最多7个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨7">秘制排骨7</i>卖光了</h2>
									<span class="money">￥<strong>10</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">14</span><span class="add"></span>
									</div>
								</div>
							</li>
							
						</ul>
					</div>
					<div class="item">
						<p>最多8个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨8">秘制排骨8</i>卖光了</h2>
									<span class="money">￥<strong>10</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">15</span><span class="add"></span>
									</div>
								</div>
							</li>
							
						</ul>
					</div>
					<div class="item">
						<p>最多9个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨9">秘制排骨9</i>卖光了</h2>
									<span class="money">￥<strong>10</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">16</span><span class="add"></span>
									</div>
								</div>
							</li>
							
						</ul>
					</div>
					<div class="item">
						<p>最多10个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨10">秘制排骨10</i>卖光了</h2>
									<span class="money">￥<strong>10</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">17</span><span class="add"></span>
									</div>
								</div>
							</li>
							
						</ul>
					</div>
					<div class="item">
						<p>最多11个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨11">秘制排骨11</i>卖光了</h2>
									<span class="money">￥<strong>10</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">18</span><span class="add"></span>
									</div>
								</div>
							</li>
							
						</ul>
					</div>
					<div class="item">
						<p>最多12个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨12">秘制排骨12</i>卖光了</h2>
									<span class="money">￥<strong>10</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">19</span><span class="add"></span>
									</div>
								</div>
							</li>
							
						</ul>
					</div>
					<div class="item">
						<p>最多13个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨13">秘制排骨13</i>卖光了</h2>
									<span class="money">￥<strong>10</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">20</span><span class="add"></span>
									</div>
								</div>
							</li>
							
						</ul>
					</div>
					<div class="item">
						<p>最多14个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨14">秘制排骨14</i>卖光了</h2>
									<span class="money">￥<strong>10</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">21</span><span class="add"></span>
									</div>
								</div>
							</li>
							
						</ul>
					</div>
					<div class="item">
						<p>最多15个字</p>
						<ul>
							<li class="clearfix">
								<img class="lazy" src="img/blank.gif" data-src="img/dish.jpg" />
								<div class="introduce">
									<h2><i id="秘制排骨15">秘制排骨15</i>卖光了</h2>
									<span class="money">￥<strong>10</strong></span>
									<div class="num clearfix">
										<span class="min"></span><span class="value">22</span><span class="add"></span>
									</div>
								</div>
							</li>
							
						</ul>
					</div>
				</section>
			</section>
			<footer id="indexFooter" class="indexFooter clearfix">
				<div class="shopCart"><span>0</span><i></i></div>
				<p>共：￥<i>0</i></p>
				<a class="buy" href="#">买单</a>
			</footer>
		</div>
		<div class="wrapper" style="display: none;">
			<div class="shoppingCart">
				<p>点单列表<span id="delete">全部删除</span></p>
				<dl id="cartList">
					<!--<dd>
						<h2>秘制排骨</h2>
						<i>￥99.99</i>
						<div class="num clearfix">
							<span class="min"></span><span class="value">0</span><span class="add"></span>
						</div>
					</dd>-->
				</dl>
			</div>
		</div>
		<span id="subMuneBtn"></span>
		<ul id="subMune" class="subMune">
			<li class="item1">
				<a href="javascript:void();"></a>
			</li>
			<li class="item2">
				<a href="javascript:void();"></a>
			</li>
			<li class="item3">
				<a href="javascript:void();"></a>
			</li>
			<li class="item4">
				<a href="javascript:void();"></a>
			</li>
		</ul>
		<script type="text/javascript">
			$(function() {
				var _header = $(".banner").height();
				var _indexFooter = $(".indexFooter").height();
				$(".indexContent").height($("body").height() - (_header + _indexFooter));
				$(".content .item:last-child").css('min-height',$("body").height() - (_header + _indexFooter));
				
				//懒加载
				checkShow();
				$(".content").on('scroll', function() { //监听滚动事件
					checkShow();
					for(var i=0;i<$(".content").find(".item").length;i++){
						var _itemTop = $(".content").find('.item').eq(i).offset().top
						if((_itemTop -_header)< 20){
							$(".menu li").eq(i).addClass("on").siblings().removeClass("on");
						}
					}
					if(menuLiIndex()>=6){
						var _menuLi = (menuLiIndex()-5)*($(".menu li").height())
						$(".menu").scrollTop(_menuLi);
					}else{
						$(".menu").scrollTop(0);
					};
				})
				
				function menuLiIndex(){
					for(var i=0;i<$(".menu li").length;i++){
						if($(".menu li").eq(i).hasClass("on")){
							var index= i;
						}
					}
					return index;
				}
				
				
				function isShow($el) {
					var winH = $(".indexContent").height(), //获取窗口高度
						scrollH = $(".content").scrollTop(), //获取窗口滚动高度
						top = $el.offset().top-$(".banner").height(); //获取元素距离窗口顶部偏移高度
//						console.log(winH*3)
					if(top < (scrollH + winH)) {
//						return $el.attr("alt","isloaded"); //在可视范围
						setTimeout(function(){
								showImg($el);
							},300);
					} else {
						return $el.attr("alt"," "); //不在可视范围
					}
				}
				
				function checkShow() { //检查元素是否在可视范围内
					$('img.lazy').each(function() { //遍历每一个元素
						var $cur = $(this);
						isShow($cur);
						if($cur.attr("alt")){
							return;
						}else{
							showImg($cur);
						}
					});
				}

				function showImg($el) {
					$el.attr("src", $el.attr("data-src"));
					$el.attr("alt", "isloaded");
				}
			})
		</script>
		<script type="text/javascript">
			var num = 0;
			var _thisName;
			var _thisPrice = 0;
			var _thisId ;
			var cartName = []; //购物车列表名称
			var dishData = []; //购物车列表数据数组
			var Isshow = true;
			$("#subMuneBtn").bind('click', function() {
					if(Isshow) {
						$(this).attr("class", "subMuneBtn");
						$("#subMune li").eq(0).animate({
							left: 3.7 + 'rem',
							bottom: 0 + 'rem',
							opacity: 1
						}, 200);
						$("#subMune li").eq(1).animate({
							left: 3 + 'rem',
							bottom: 1.8 + 'rem',
							opacity: 1
						}, 150);
						$("#subMune li").eq(2).animate({
							left: 1.65 + 'rem',
							bottom: 3.1 + 'rem',
							opacity: 1
						}, 100);
						$("#subMune li").eq(3).animate({
							left: 0,
							bottom: 3.8 + 'rem',
							opacity: 1
						}, 50);
						Isshow = false;
						return false;
					} else {
						$(this).attr("class", " ");
						$("#subMune li").eq(0).animate({
							left: 0 + 'rem',
							bottom: 0 + 'rem',
							opacity: 0
						}, 50);
						$("#subMune li").eq(1).animate({
							left: 0 + 'rem',
							bottom: 0 + 'rem',
							opacity: 0
						}, 100);
						$("#subMune li").eq(2).animate({
							left: 0 + 'rem',
							bottom: 0 + 'rem',
							opacity: 0
						}, 150);
						$("#subMune li").eq(3).animate({
							left: 0 + 'rem',
							bottom: 0 + 'rem',
							opacity: 0
						}, 200);
						Isshow = true;
						return false;
					}

				})
				//左侧菜单选择
			$(".menu li").bind('click', function() {
					var _thisIndex = $(this).index();
					var _item = 0;
					$(this).addClass("on").siblings().removeClass("on");
					for(var i = 0; i < _thisIndex; i++) {
						_item += $(".content .item").eq(i).height();
					}
					$(".content").animate({
						"scrollTop": _item
					}, 0);
				})
			//点击购物车小图标效果
			function showShopping() {
				$(".shopCart").bind('click', function() {
					if($("#indexFooter").hasClass("on")) {
						$(".wrapper").show();
					}
				})
			}
			$(".wrapper").bind('click', function() {
				$(this).hide();
			})
			$(".shoppingCart").bind("click", function() {
				if(document.all) {
					window.event.cancelBubble = true;
				} else {
					event.stopPropagation();
				}
			});

			$("#delete").bind('click', function() {
				var r = confirm("是否清空购物车？");
				if(r == true) {
					$("#cartList").empty();
					$(".wrapper").hide();
					$("#indexFooter").removeClass("on");
					$(".content .item li").find(".min").hide();
					$(".content .item li").find(".value").text(0).hide();
					num = 0;
					cartName = [];
					dishData = [];
				}
			})

			//购物车减一份
			function shoppingCartMin(obj) {
				_thisName = obj.parents("dd").find("h2").text();
				_thisPrice = parseFloat(obj.parents("dd").find("strong").text()).toFixed(1);
				_thisId = $(this).parents(".introduce").find("i").attr("id");
				num = parseInt(dishData[jQuery.inArray(_thisName, cartName)].num);
				num -= 1;
				if(num == 0) {
					obj.parents("dd").remove();
					dishData.splice(jQuery.inArray(_thisName, cartName), 1);
					cartName.splice(jQuery.inArray(_thisName, cartName), 1);
					$(".shopCart span").text(CountNum(dishData));
					$("#indexFooter p i").text(CountPrice(dishData));
					if(dishData.length == 0) {
						$(".wrapper").hide();
						$("#indexFooter").removeClass("on");
						$(".content .item li").find(".min").hide();
						$(".content .item li").find(".value").text(0).hide();
						num = 0;
						cartName = [];
						dishData = [];
					}
				} else {
					obj.next().text(num);
					dishData[jQuery.inArray(_thisName, cartName)].num = num;
					$(".shopCart span").text(CountNum(dishData));
					$("#indexFooter p i").text(CountPrice(dishData));
				}
				console.log(JSON.stringify(dishData));
			}

			//购物车加一份
			function shoppingCartAdd(obj) {
				_thisName = obj.parents("dd").find("h2").text();
				_thisPrice = parseFloat(obj.parents("dd").find("strong").text()).toFixed(1);
				num = parseInt(dishData[jQuery.inArray(_thisName, cartName)].num);
				num += 1;
				obj.prev().text(num);
				dishData[jQuery.inArray(_thisName, cartName)].num = num;
				$(".shopCart span").text(CountNum(dishData));
				$("#indexFooter p i").text(CountPrice(dishData));
				console.log(JSON.stringify(dishData));
			}

			//计算点菜的总份数
			function CountNum(ment) {
				var CountNum = 0;
				for(var i = 0; i < ment.length; i++) {
					CountNum += ment[i].num;
				}
				return CountNum;
			}
			//计算点菜的总价值
			function CountPrice(ment) {
				$("#indexFooter p i").text(' ');
				var CountPrice = 0;
				console.log(JSON.stringify(ment));
				for(var i = 0; i < ment.length; i++) {
					CountPrice += (parseFloat(ment[i].price) * ment[i].num);
				}
				console.log(CountPrice.toFixed(2));
				return CountPrice.toFixed(2);
			}

			$(".content .item").each(function() {
				$(this).find("li").each(function() {
					//减一份
					$(this).find(".min").bind('click', function() {
						_thisName = $(this).parents(".introduce").find("i").text();
						_thisPrice = parseFloat($(this).parents(".introduce").find("strong").text()).toFixed(1);
						_thisId = $(this).parents(".introduce").find("i").attr("id");
						console.log(JSON.stringify(cartName));
						console.log(JSON.stringify(dishData));
						num = parseInt(dishData[jQuery.inArray(_thisName, cartName)].num);
						num -= 1;
						if(jQuery.inArray(_thisName, cartName) != -1) {
							if(num == 0) {
								$(this).hide();
								$(this).next().hide().text(0);
								$("#cartList dd").eq(jQuery.inArray(_thisName, cartName)).remove();
								dishData.splice(jQuery.inArray(_thisName, cartName), 1);
								cartName.splice(jQuery.inArray(_thisName, cartName), 1);
								if(cartName.length == 0) {
									$("#indexFooter").removeClass("on");
								}
								$(".shopCart span").text(CountNum(dishData));
								$("#indexFooter p i").text(CountPrice(dishData));
							} else {
								$(this).next().text(num);
								$("#cartList dd").eq(jQuery.inArray(_thisName, cartName)).find(".value").text(num);
								dishData[jQuery.inArray(_thisName, cartName)].num = num;
								$(".shopCart span").text(CountNum(dishData));
								$("#indexFooter p i").text(CountPrice(dishData));
							}
						}
						console.log(JSON.stringify(cartName));
						console.log(JSON.stringify(dishData));
					});
					//加一份
					$(this).find(".add").bind('click', function() {
						_thisName = $(this).parents(".introduce").find("i").text();
						_thisPrice = parseFloat($(this).parents(".introduce").find("strong").text()).toFixed(1);
						_thisId = $(this).parents(".introduce").find("i").attr("id");
						num += 1;
						$(this).prevAll().show();
						if(cartName.length == 0) {
							$(this).prev().text(num);
							$("#cartList").append('<dd><h2 id='+_thisId+'>' + _thisName + '</h2><i>￥<strong>' + _thisPrice + '</strong></i>' +
								'<div class="num clearfix"><span class="min" onclick="shoppingCartMin($(this));">' +
								'</span><span class="value">' + num + '</span>' +
								'<span class="add needsclick" onclick="shoppingCartAdd($(this));"></span></div></dd>');
							cartName.push(_thisName);
							dishData.push({
								'id':_thisId,
								'name': _thisName,
								'price': _thisPrice,
								'num': num
							});
							$(".shopCart span").text(num);
							$("#indexFooter p i").text(_thisPrice);
						} else {
							if(jQuery.inArray(_thisName, cartName) == -1) {
								num = 1;
								$(this).prev().text(num);
								$("#cartList").append('<dd><h2 id='+_thisId+'>' + _thisName + '</h2><i>￥<strong>' + _thisPrice + '</strong></i>' +
									'<div class="num clearfix"><span class="min" onclick="shoppingCartMin($(this));">' +
									'</span><span class="value">' + num + '</span>' +
									'<span class="add needsclick" onclick="shoppingCartAdd($(this));"></span></div></dd>');
								cartName.push(_thisName);
								dishData.push({
									'id':_thisId,
									'name': _thisName,
									'price': _thisPrice,
									'num': num
								});
								$(".shopCart span").text(CountNum(dishData));
								$("#indexFooter p i").text(CountPrice(dishData));
							} else {
								num = parseInt(dishData[jQuery.inArray(_thisName, cartName)].num);
								num += 1;
								$(this).prev().text(num);
								$("#cartList dd").eq(jQuery.inArray(_thisName, cartName)).find(".value").text(num);
								dishData[jQuery.inArray(_thisName, cartName)].num = num;
								$(".shopCart span").text(CountNum(dishData));
								$("#indexFooter p i").text(CountPrice(dishData));
							}
						}
						if(cartName.length > 0) {
							$("#indexFooter").addClass("on");
							showShopping();
						} else {
							$("#indexFooter").removeClass("on");
							showShopping();
						}

					});
				})
			})
		</script>
	</body>

</html>